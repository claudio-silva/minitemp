/* Copyright 2014 Cláudio Silva */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.minitemp=b()}(this,function(){function a(a){a=a||{},k(a,s),t=a,u=new RegExp(a.open+"([^\\s\\w}]+)?\\s*([\\s\\S]*?)\\s*"+a.close,"g")}function b(a,b,c){j(a,function(d,e){if(d)c(d);else{var g=f(a,e);try{c(null,g(b))}catch(d){c(d)}}})}function c(a,b){return g(a)(b||{})}function d(a,b){var c=o[a];if(!c)throw new Error(l("Template ? not found",a));return c(b)}function e(a,b){return o[a]=g(b)}function f(a,b){var c=o[a];return c?c:o[a]=g(b)}function g(a){for(var b=[],c=[],d=a.replace(u,function(a,b,d){if(d instanceof Function&&(d=d()),d=null==d?"":String(d))switch(b||""){case"":c.push(h(d));break;case"=":c.push("$o.push(e("+d+"));");break;case"==":case"-":c.push("$o.push("+d+");");break;case"#":c.push("");break;default:throw new Error("Unknown template tag "+t.open+b)}return"§§"}),e=d.split(/§§/g),f=0,g=e.length;g>f;++f)b.push("$o.push('"+e[f].replace(/\n/g,"\\n").replace(/'/g,"\\'")+"');"),g-1>f&&c[f]&&b.push(c[f]);return i(b.join("\n"))}function h(a){for(var b=0,c=r.length;c>b;++b)a=a.replace(r[b][0],r[b][1]);return a}function i(a){try{var b=Function("scope","context","API","var $o=[];\nwith (API) with (context) with (scope) {\n"+a+'\n}\nreturn $o.join("")');return function(a){return b(a||{},t.context,q)}}catch(c){throw console.log("\nCompiled template:\n"),console.log(a),c}}function j(a,b){if("undefined"!=typeof $)return $.get(a).then(function(a){b(null,a)},function(a){b(a)});if(n){var c=require("fs");c.readFile(a,b)}else{if("undefined"==typeof XMLHttpRequest)throw new Error("No API is available for loading files");var d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&(200===d.status?b(null,d.responseText):b(d))},d.open("GET",a,!0),d.send()}}function k(a,b){if(a)for(var c in b)b.hasOwnProperty(c)&&void 0===a[c]&&(a[c]=b[c])}function l(a){var b=1,c=arguments;return"string"==typeof a?a.replace(/\?/g,function(){return c[b++]}):""}function m(){var a=jQuery;a.fn.render=function(c,e){var f,h;switch(c[0]){case"#":case".":h=c.substr(1),f=o[h],f||(f=o[h]=g(a(c).html())),this.html(f(e));break;case"@":this.html(d(c.substr(1),e));break;default:var i=this;b(c,e,function(a,b){if(a)throw a;i.html(b)})}return this}}var n="undefined"!=typeof process&&"node"==process.title,o={},p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},q={e:function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return p[a]})},ea:function(a){return a.replace(/"/g,"&quot;")},attr:function(a,b,c,d){var e=null!=b&&""!==b?l.apply(null,[b].concat(c)):d||"";return e?a+'="'+q.ea(e)+'"':""},showIf:function(a){return a?"":'style="display:none"'},dynalist:function(a,b){var c=[];for(var d in a)a.hasOwnProperty(d)&&a[d]&&c.push(d);return c.join(void 0===b?" ":"")},sprintf:l},r=[[/for\s*\(\s*(\w+)\s+in\s+(.+?)\)/g,"for (var _$1=0, __$1=$2.length, $1; $1=$2[_$1], _$1<__$1; ++_$1)"]],s={open:"<%",close:"%>",context:{}};"undefined"!=typeof jQuery&&m();var t,u;return a(),{render:c,renderFile:b,renderTemplate:d,defineTemplate:e,compile:g,config:a,API:q,macros:r,load:j}});